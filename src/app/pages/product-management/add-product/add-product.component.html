<div class="flex-between">
    <span class="txt-bold">{{dialogData.product ? 'Cập nhật sản phẩm' :'Thêm sản phẩm'}}</span>
    <mat-icon mat-dialog-close class="pointer">close</mat-icon>
</div>

<mat-dialog-content>
    <!-- <mat-grid-list cols="1" rowHeight="40px">
        <mat-grid-tile>
            <mat-card-title>
                {{dialogData.product ? 'Cập nhật sản phẩm' :'Thêm sản phẩm'}}
            </mat-card-title>
        </mat-grid-tile>
    </mat-grid-list> -->
    <form class="example-form" [formGroup]="form">
        <mat-grid-list cols="1" rowHeight="80px">
            <mat-grid-tile>
                <mat-form-field class="example-full-width">
                    <mat-label>Tên sản phẩm</mat-label>
                    <input matInput placeholder="Tên sản phẩm" formControlName="productName">
                </mat-form-field>
            </mat-grid-tile>


        </mat-grid-list>
        <mat-grid-list cols="2" rowHeight="80px">
            <mat-grid-tile>
                <mat-form-field [hideRequiredMarker]="false">
                    <mat-label>Loại sản phẩm</mat-label>
                    <mat-select placeholder="Loại sản phẩm" formControlName="category" (valueChange)="onSelectCat($event)">

                        <mat-select-trigger>
                            <span>{{catName}}</span>
                          </mat-select-trigger>
                        <mat-option>
                            <ngx-mat-select-search formControlName="searchCat" placeholderLabel="Loại món ăn"></ngx-mat-select-search>
                          </mat-option>
                        <mat-option *ngIf="form?.value?.searchCat">
                            <div class="flex-between">
                                <span>{{form?.value?.searchCat}} </span>
                                <mat-icon class="pointer" style="padding-top: 11px;" (click)=" $event.stopPropagation(); createCat()">add_box</mat-icon>
                            </div>
                        </mat-option>

                        <mat-option *ngFor="let cat of categories; let i = index" [value]="cat?.key" >
                            <div class="flex-between">
                                <span>{{cat?.categoryName}} </span>
                                <mat-icon class="pointer" style="padding-top: 11px;" (click)=" $event.stopPropagation(); removeCat(cat,i)">close</mat-icon>
                            </div>
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
                <mat-form-field [hideRequiredMarker]="false" [floatLabel]="'auto'">
                    <mat-label>Đơn giá</mat-label>
                    <input matInput appInputNumber placeholder="Đơn giá" type="number" formControlName="price">
                </mat-form-field>
            </mat-grid-tile>

        </mat-grid-list>
        <mat-grid-list cols="2" rowHeight="80px">
            <mat-grid-tile>
                <mat-form-field [hideRequiredMarker]="false" [floatLabel]="'auto'">
                    <mat-label>Giá khuyến mại</mat-label>
                    <input appInputNumber matInput placeholder="Giá khuyến mại" type="number"
                        formControlName="promotionPrice">
                    <mat-error *ngIf="form?.controls?.promotionPrice.touched 
                        && form?.controls?.promotionPrice?.invalid && 
                        form.controls.promotionPrice?.errors?.mustLower">
                        Giá khuyến mại phải nhỏ hơn giá sản phẩm
                    </mat-error>
                </mat-form-field>


            </mat-grid-tile>

            <mat-grid-tile>
                <mat-form-field [hideRequiredMarker]="false" [floatLabel]="'auto'">
                    <mat-label>Đơn vị tính</mat-label>
                    <input matInput placeholder="Đơn vị tính" formControlName="unit">
                </mat-form-field>
            </mat-grid-tile>

        </mat-grid-list>




        <mat-form-field class="example-full-width">
            <textarea matInput placeholder="Mô tả" matTextareaAutosize matAutosizeMinRows="2" formControlName="detail"
                matAutosizeMaxRows="5"></textarea>
        </mat-form-field>

        <mat-form-field>
            <ngx-mat-file-input formControlName="displayImage" [accept]="'image/*'" placeholder="Ảnh đại diện sản phẩm"
                (change)="onChangeDisplayImage($event)">
            </ngx-mat-file-input>
            <mat-icon matSuffix>folder</mat-icon>
        </mat-form-field>
        <div class="group-img">
            <div class="item">
                <div class="item-inner">
                    <img class="display-image" [src]="displayImage || 'assets/images/defaults/default-product.jpg'">
                </div>
                <button mat-icon-button (click)="removeDisplayImage()" type="button" color="warn" aria-label="xoá">
                    <mat-icon>delete</mat-icon>
                </button>
                <!-- <button type="button" (click)="removeDisplayImage()">xoá</button> -->
            </div>
        </div>

        <mat-form-field>
            <ngx-mat-file-input formControlName="photos" [accept]="'image/*'" placeholder="Ảnh chi tiết sản phẩm"
                multiple (change)="onFileChange($event)">
            </ngx-mat-file-input>
            <mat-icon matSuffix>folder</mat-icon>
        </mat-form-field>
        <div class="group-img">
            <div class="item" *ngFor='let url of images;let i = index'>
                <div class="item-inner">
                    <img class="display-image" [src]="url || 'assets/images/defaults/default-product.jpg'">
                </div>
                <button mat-icon-button (click)="removePhoto(i,url)" type="button" color="warn" aria-label="xoá">
                    <mat-icon>delete</mat-icon>
                </button>
            </div>
        </div>

    </form>
</mat-dialog-content>

<div class="flex-end">
    <button mat-raised-button color="primary" *ngIf="!dialogData.product" [disabled]='loading' (click)="create()">
        <app-loading-inside-btn *ngIf="loading"></app-loading-inside-btn>
        {{loading?'':'Thêm'}}
    </button>

    <button mat-raised-button color="primary" *ngIf="dialogData.product" [disabled]='loading' (click)="updateProduct()">
        <app-loading-inside-btn *ngIf="loading"></app-loading-inside-btn>
        {{loading?'':'Cập nhật'}}
    </button>

    <!-- <button mat-raised-button color="warn">Huỷ</button> -->
</div>